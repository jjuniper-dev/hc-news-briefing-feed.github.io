name: Daily Feed Health Check

on:
  schedule:
    # Runs daily at 6:00 AM Eastern Time (10:00 UTC)
    - cron: '0 10 * * *'
  workflow_dispatch:

jobs:
  ping-canadian-feeds:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install feedparser requests

      - name: Test Canadian feeds
        id: test_canada
        run: |
          import sys, feedparser, requests

          feeds = {
              "CBC Canada":   "https://www.cbc.ca/cmlink/rss-topstories",
              "CTV Top News": "https://www.ctvnews.ca/rss/ctvnews-ca-canada-1.796439",
          }

          failed = []
          for name, url in feeds.items():
              try:
                  resp = requests.get(url, timeout=20)
                  resp.raise_for_status()
                  feed = feedparser.parse(resp.content)
                  if not feed.entries:
                      print(f"❌ {name}: 0 entries")
                      failed.append(name)
                  else:
                      print(f"✔️ {name}: {len(feed.entries)} entries")
              except Exception as e:
                  print(f"❌ {name}: ERROR → {e}")
                  failed.append(name)

          if failed:
              sys.exit(f"Feeds failing: {', '.join(failed)}")

      # Optional: send email or Slack on failure
      - name: Notify on failure
        if: failure()
        run: |
          echo "One or more Canadian feeds failed. Check the Actions log for details." 
          # Here you could call curl to a Slack webhook or similar