name: Test Feeds

on:
  schedule:
    # 6 AM, 10 AM, 2 PM, 6 PM, 10 PM daily
    - cron: '0 6,10,14,18,22 * * *'
  workflow_dispatch:         # allows manual runs

jobs:
  test_feeds:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repo
        uses: actions/checkout@v3
        with:
          persist-credentials: true  # needed for later commits

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies (if any)
        run: |
          if [ -f requirements.txt ]; then
            echo "requirements.txt found, installing…"
            pip install -r requirements.txt
          else
            echo "No requirements.txt—skipping install."
          fi

      - name: Run feed-test suite
        run: python test_feeds.py     # adjust if your script name is different

      - name: Commit updated health.json
        uses: EndBug/add-and-commit@v9
        with:
          author_name: 'github-actions'
          author_email: 'github-actions@github.com'
          message: 'chore: update health.json'