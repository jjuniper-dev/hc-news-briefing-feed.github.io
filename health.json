      - name: Persist health.json
        env:
          FEED_STATUS: ${{ steps.health.outputs.feed_status }}
        run: |
          python3 - << 'EOF'
          import os, json
          from datetime import datetime

          # Load the correct feed_status JSON (not the mail step output)
          feed_status = json.loads(os.environ['FEED_STATUS'])

          path = 'health.json'
          try:
              # Read existing history
              with open(path, 'r') as f:
                  data = json.load(f)
          except (FileNotFoundError, json.JSONDecodeError):
              data = {}

          # Add todayâ€™s entry
          today = datetime.now().strftime('%Y-%m-%d')
          data[today] = feed_status

          # Write back the full object
          with open(path, 'w') as f:
              json.dump(data, f, indent=2)
          EOF