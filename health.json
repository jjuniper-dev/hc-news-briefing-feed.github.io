      - name: Persist health.json
        env:
          FEED_STATUS: ${{ steps.health.outputs.feed_status }}
        run: |
          python3 - << 'EOF'
          import os, json
          from datetime import datetime

          feed_status = json.loads(os.environ['FEED_STATUS'])
          path = 'health.json'

          # Safely load existing data, or start over if it's missing/invalid
          try:
              with open(path, 'r') as f:
                  data = json.load(f)
          except (FileNotFoundError, json.JSONDecodeError):
              data = {}

          # Append today's snapshot
          today = datetime.now().strftime('%Y-%m-%d')
          data[today] = feed_status

          # Write back as pretty JSON
          with open(path, 'w') as f:
              json.dump(data, f, indent=2)
          EOF