steps:
  - name: Checkout repository
    uses: actions/checkout@v3
    with:
      persist-credentials: true

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: '3.11'

  - name: Install dependencies
    run: |
      python3 -m pip install --upgrade pip
      pip install feedparser requests python-dateutil

  - name: Generate latest.txt
    run: |
      python3 generate_latest.py

  - name: Commit and push
    run: |
      git config user.name "github-actions[bot]"
      git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
      git add latest.txt
      git commit -m "chore: auto-update latest.txt for $(date +'%Y-%m-%d')" || echo "No changes to commit"
      git push origin HEAD:main